<!doctype html>
<html>
<head>
	<title>Diggs</title>
	<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">
	<link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
	<link href="https://unpkg.com/material-components-web@v4.0.0/dist/material-components-web.min.css" rel="stylesheet">
	<script src="https://unpkg.com/material-components-web@v4.0.0/dist/material-components-web.min.js"></script>
	<script src="/socket.io/socket.io.js"></script>
	<script src="https://code.jquery.com/jquery-3.4.1.min.js"></script>


	<style>
		body { margin: 0; padding: 0;}

		:root {
			--mdc-theme-primary: #048C93;
			--mdc-theme-secondary: #F37306;
			--mdc-theme-on-primary: #fff;
			--mdc-theme-on-secondary: #fff;
			--mdc-theme-background: #eee;
		--mdc-theme-surface: #fff;
		--mdc-theme-on-surface: #202020;
		--mdc-theme-error: #E20531;
		}

		.color-light-container { background-color: #F8A55F; color: #fff; }
		.mdc-chip--mine { background-color: #F8A55F; color: #fff; }

		.page-container {
			position: relative;
		}

		.page-content {
			height: 100%;
			box-sizing: border-box;
			max-width: 100%;
			width: 100%;
			overflow: auto;
			/* padding: 0 1em; */
			padding-left: 1em;
			padding-right: 1em;
		}

		.section-title {
			border-bottom: 1px solid rgba(0,0,0,.87);
		}

		@media(min-width: 1024px) {
			.app-fab--absolute {
				bottom: 1.5rem;
				right: 1.5rem;
			}
		}

	</style>
</head>
<body class="mdc-typography">
	<div id="root"><div class="page-container">
		<header class="mdc-top-app-bar mdc-top-app-bar--fixed">
			<div class="mdc-top-app-bar__row">
				<section class="mdc-top-app-bar__section mdc-top-app-bar__section--align-start">
					<button class="material-icons mdc-top-app-bar__navigation-icon mdc-icon-button">menu</button>
					<span class="mdc-top-app-bar__title">Diggs</span>
				</section>
				<section class="mdc-top-app-bar__section mdc-top-app-bar__section--align-end">
					<button class="mdc-icon-button material-icons mdc-top-app-bar__action-item--unbounded" aria-label="Play next round">play_arrow</button>
					<button id="editButton" class="mdc-icon-button material-icons mdc-top-app-bar__action-item--unbounded" aria-label="Edit name">edit</button>
				</section>
			</div>
		</header>

		<div class="page-content mdc-top-app-bar--fixed-adjust">
			
			<h2 class="section-title mdc-typography--headline6">Connected players</h2>

			<div class="mdc-chip-set " role="grid" id="playerChips">
			</div>

			<h2 class="section-title mdc-typography--headline6">Story</h2>
			<p class="mdc-typography--body">The game has not yet started.</p>

			<h2 class="section-title mdc-typography--headline6">Your hand</h2>

		</div>
		
		<!--div class="mdc-layout-grid mdc-top-app-bar--fixed-adjust">
			<div class="mdc-layout-grid__inner">
				<div class="mdc-layout-grid__cell mdc-layout-grid__cell--span-12">
					<label class="mdc-typography mdc-typography--subtitle1" id="stateText">Connected players</label>
				</div>
			</div>
		</div-->
		

		<div class="mdc-layout-grid">
			<div class="mdc-layout-grid__inner">
				<div class="mdc-layout-grid__cell">
				
				</div>
				<div class="mdc-layout-grid__cell">
					
				</div>
				<div class="mdc-layout-grid__cell">
					
				</div>
				<div class="mdc-layout-grid__cell">
					
				</div>
			</div>
		</div>


	<div class="mdc-dialog" id="#nameDialog">
	  <div class="mdc-dialog__container">
		<div class="mdc-dialog__surface"
		  role="alertdialog"
		  aria-modal="true"
		  aria-labelledby="my-dialog-title"
		  aria-describedby="my-dialog-content">
		  <!-- Title cannot contain leading whitespace due to mdc-typography-baseline-top() -->
		  <h2 class="mdc-dialog__title" id="my-dialog-title"><!--
		 -->What's your name?<!--
	   --></h2>
		  <div class="mdc-dialog__content" id="my-dialog-content">

	<label class="mdc-text-field">
	  <div class="mdc-text-field__ripple"></div>
	  <input class="mdc-text-field__input" type="text" id="nameInput" aria-labelledby="my-label-id">
	  <span class="mdc-floating-label" id="my-label-id">Name</span>
	  <div class="mdc-line-ripple"></div>
	</label>

		  </div>
		  <footer class="mdc-dialog__actions">
			<button type="button" class="mdc-button mdc-dialog__button" data-mdc-dialog-action="close">
			  <div class="mdc-button__ripple"></div>
			  <span class="mdc-button__label">Cancel</span>
			</button>
			<button type="button" class="mdc-button mdc-dialog__button mdc-dialog__footer__button--accept" data-mdc-dialog-action="accept" data-mdc-dialog-button-default>
			  <div class="mdc-button__ripple"></div>
			  <span class="mdc-button__label">Ok</span>
			</button>
		  </footer>
		</div>
	  </div>
	  <div class="mdc-dialog__scrim"></div>
	</div>
	</div></div>

	<script>
		

		var id;
		var socket;
		var nameDialog;

		function you(data) {
			//console.log(data);
			id = data.id;
			$("#chip"+id).addClass('mdc-chip--mine');
		}

		function displayPlayers(data) {
			//console.log(data); 
			$("#playerChips").empty();
			for (var i = 0; i < data.length; i++) {
				addPlayerChip(data[i]);
			}
		}

		function addPlayerChip(data) {
			var $chip = $('<div class="mdc-chip" role="row" id="chip'+data.id+'"><div class="mdc-chip__ripple"></div><span role="gridcell"><span role="button" class="mdc-chip__primary-action"><span class="mdc-chip__text">'+data.name+'</span></span></span></div>');
			if (data.id == id) $chip.addClass('mdc-chip--mine');
			$("#playerChips").append($chip);
		}

		function connected() {
			if (!sessionStorage.getItem('playerName')) {
				nameDialog.open();
			}
			else {
				setName(sessionStorage.getItem("playerName"));
			}
		}


		function setName(str) {
			sessionStorage.setItem('playerName', str);
			socket.emit('me', str);
		}


		$(document ).ready(function() {
			const MDCDialog = mdc.dialog.MDCDialog;
			const MDCDialogFoundation = mdc.dialog.MDCDialogFoundation;

			nameDialog = new MDCDialog(document.getElementById('#nameDialog'));
			nameDialog.listen('MDCDialog:closed', function(data) {
				if (data.detail.action == 'accept') setName($('#nameInput').val());
			});

			mdc.textField.MDCTextField.attachTo(document.querySelector('.mdc-text-field'));

			socket = io('/');
			socket.on('connect', function(data){connected()});
			socket.on('players', function(data){displayPlayers(data)});
			socket.on('you', function(data){you(data)});
			socket.on('disconnect', function(){});

			$("#editButton").click(function() {
				nameDialog.open();
			});

			
		});

	</script>
</body>
</html>